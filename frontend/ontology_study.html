<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="assets/css/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- <script src="assets/js/webgazer.js"></script> -->
    <script src="assets/js/aoi-selection.js"></script>
    <script src="assets/js/eyetracking.js"></script>
    <script src="assets/js/calibration.js"></script>

    <script src="assets/js/node-link3.js"></script>
    <script src="assets/js/circle-packing3.js"></script>
    <script src="assets/js/circlePack-fruits.js"></script>
    <script src="assets/js/tree-map3.js"></script>

    <script src="assets/js/CirclePack.js"></script>
    <script src="assets/js/TreeMap.js"></script>

    <script src="assets/json/circlePack.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <!--Imports for data files, originally JSON but translated to Javascript for functionality-->
    <script src="assets/json/pizza-baseline.js"></script>
    <script src="assets/json/pizza-treeMap.js"></script>
    <script src="assets/json/pizza-circlePack.js"></script>
    <script src="assets/json/music_base.js"></script>
    <script src="assets/json/restaurant_base.js"></script>

    <script src="assets/json/citizen.js"></script>
    <script src="assets/json/fruit-circlePack.js"></script>
    <script src="assets/json/pasta-circlePack.js"></script>
    <script src="assets/json/wine-base.js"></script>

    <script type="text/javascript" src="./The Pizza Ontology_files/jquery-1.8.3.min.js"></script>
</head>

<!--Main body of the webpage-->
<body class="h_main">
    <div id="researcherPage" style="display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;">
        <div style="text-align:center;font-size:40px;"> Researcher Page </div>
        <div style="display:flex;flex-direction:row;justify-content:center;align-items:center;width:100%;height:80%;">
            <div style="display:flex;flex-direction:column;align-items:center;width:700px;height:700px;justify-content:space-between;">
                <button id="b012" class = "h_researcher_button" onclick="changeVisuals(0)">
                    <div>Set 1</div>
                    <div>Network -> Circle -> Tree</div>
                </button>
                <button id="b021" class = "h_researcher_button" onclick="changeVisuals(1)">
                    <div>Set 2</div>
                    <div>Network -> Tree - Circle</div>
                </button>
                <button id="b102" class = "h_researcher_button" onclick="changeVisuals(2)">
                    <div>Set 3</div>
                    <div>Circle -> Network -> Tree</div>
                </button>
                <button id="b120" class = "h_researcher_button" onclick="changeVisuals(3)">
                    <div>Set 4</div>
                    <div>Circle -> Tree -> Network</div>
                </button>
                <button id="b201" class = "h_researcher_button" onclick="changeVisuals(4)">
                    <div>Set 5</div>
                    <div>Tree -> Network -> Circle</div>
                </button>
                <button id="b210" class = "h_researcher_button" onclick="changeVisuals(5)">
                    <div>Set 6</div>
                    <div>Tree -> Circle -> Network</div>
                </button>
            </div>
        </div>
        <button id = "researchContinue" class = "h_researcher_button" onclick="confirmResearcherPage()" disabled="true">Continue</button>
    </div>

    <script>
        ///////////////////////////////////////////////////////////////////////////////////////////
        // ESTABLISHING THE ORDER OF VISUALIZATIONS DURING THE ASSESSMENT 
        //
        //
        //// In this area, the researcher will be able to select from predetermined sets of visualizations in order to add variety to study sessions
        let visualOrder = [0, 1, 2];        //The current order of visualizations
        let visualSet = -1;                 //The number of the visualization order chosen (-1 until one is selected)

        //The buttons used to select from the 6 different visualization sets 
        const visualButtons = [
        document.getElementById("b012"),
        document.getElementById("b021"),
        document.getElementById("b102"),
        document.getElementById("b120"),
        document.getElementById("b201"),
        document.getElementById("b210")
        ]

        //Function for letting the researcher choose a new set of visualizations
        function changeVisuals(i)
        {
            //The 6 sets of possible visualization orders
            let orders = [
            [0, 1, 2],
            [0, 2, 1],
            [1, 0, 2],
            [1, 2, 0],
            [2, 0, 1],
            [2, 1, 0]
            ]

            //Set the visual set and visual order to that selected by the researcher 
            visualSet = i;
            visualOrder = orders[visualSet];

            //Enable all buttons, and only disabled the one that is currently selected, ensuring the researcher won't select it again
            visualButtons.map(b => b.disabled = false);
            visualButtons[visualSet].disabled = true;

            //Enable the researcher to move forward 
            document.getElementById("researchContinue").disabled = false;
        }

        //Function for confirming the researcher page selection, only usable once a visualization set has been selected
        function confirmResearcherPage()
        {
            //Move the page to the main consent form 
            document.getElementById("researcherPage").style.display = "none";
            document.getElementById("introPage").style.display = "flex";
        }

    </script>


    <!--Display for the introductory screen-->
    <div id="introPage" style="display:none;flex-direction:column;justify-content:space-evenly;align-items:center;height:900px;width:100%">
        <div class="h_intro_text">Informed Consent</div>
        <div class="h_intro_consent">

            <!--Consent Form-->
            <div style="height:100%;overflow-y:scroll;margin-bottom:10px;">
                <div class="h_consent_bullet_title">Introduction</div>
                <div class="h_consent_bullet_text">This study is conducted by a team of undergraduate and graduate student 
                    researchers under the supervision of Dr. Bo Fu as part of a research project that aims to evaluate interactive 
                    visualizations in their support for the human user when making sense of ontological relationships.
                </div>

                <div class="h_consent_bullet_title">Purpose and Objectives</div>
                <div class="h_consent_bullet_text">The goal of this study is to assess visualization techniques and the extent to which they can support human users during interactions with ontological relations. The findings from this research will inform the future design and development of visualization techniques.  
                </div>

                <div class="h_consent_bullet_title">Importance Of Research</div>
                <div class="h_consent_bullet_text">The research and data collected within this study will offer insights on the desirable visual attributes that can effectively illustrate relationships between ontological entities. The findings from this research will generate new knowledge contributing to the advancement of this field. 
                </div>

                <div class="h_consent_bullet_title">Participation Selection</div>
                <div class="h_consent_bullet_text">No prior knowledge of ontology or ontology mappings is required. Individuals who are eighteen years old or older are invited to participate.</div>

                <div class="h_consent_bullet_title">What is Involved?</div>
                <div class="h_consent_bullet_text">If you consent to voluntarily participate in this study, you will be asked to complete brief tutorials on ontologies and visualizations. You will be asked to take part in interviews and complete questionnaires to express your satisfaction with the given visualizations. An eye tracker will be used to observe your interaction with the given visualizations and your gaze data will be collected (such as how long your gaze was fixated on a particular visual cue). This study will take place in Room 128A in the Vivian Engineering Center (VEC), California State University of Long Beach.
                </div>

                <div class="h_consent_bullet_title">Duration</div>
                <div class="h_consent_bullet_text">The study is estimated to take approximately one hour of your time. It is advised that you set aside approximately 1.5 hours to accommodate potential delay.</div>

                <div class="h_consent_bullet_title">Risks</div>
                <div class="h_consent_bullet_text">There are no known or anticipated risks to you by participating in this research.</div>

                <div class="h_consent_bullet_title">Benefits</div>
                <div class="h_consent_bullet_text">The potential benefits of you participating in this study include contributing to the understanding of visualizations for ontological relationships and the field as a whole. This could lead to future advancements in the visualizations designed for ontological relations.
                </div>

                <div class="h_consent_bullet_title">Voluntary Participation</div>
                <div class="h_consent_bullet_text">Your participation in this research is entirely voluntary. You may withdraw at any moment without consequences nor explanation. If you do so, your data will be destroyed permanently. 
                </div>

                <div class="h_consent_bullet_title">Compensation</div>
                <div class="h_consent_bullet_text">The compensation for taking part in this study is $25 BeachBucks, which will be deposited directly into the account associated with your student ID.</div>

                <div class="h_consent_bullet_title">Anonymity</div>
                <div class="h_consent_bullet_text">All participants and the data generated in this study will be anonymized.</div>

                <div class="h_consent_bullet_title">Confidentiality</div>
                <div class="h_consent_bullet_text">All participants' information and the data collected in this study are anonymized. Your confidentiality and the confidentiality of the data are protected in secured storage, accessible by the research team only.
                </div>

                <div class="h_consent_bullet_title">Dissemination of Results</div>
                <div class="h_consent_bullet_text">It is anticipated that the results of this study will be shared with others in the following ways: scientific websites, articles, and presentations. Where used in publications, all data will be aggregated, and no personally identifiable information will be published. 
                </div>

                <div class="h_consent_bullet_title">Disposal of Data</div>
                <div class="h_consent_bullet_text">Data collected from this study will be safely kept during the duration of the study. Once completed the data will be disposed of permanently. </div>

                <div class="h_consent_bullet_title">Contact Information</div>
                <div class="h_consent_bullet_text">If you have any questions about this research, please contact Dr. Bo Fu (Bo.Fu@csulb.edu). If you have any questions about the conduct of this study protocol, particularly about providing informed consent and unexpected contingencies, please contact the IRB Office (IRB@csulb.edu). 
                </div>

                <!--
                <div class="h_consent_bullet_title">Consent</div>
                <div class="h_consent_bullet_text">By checking the box below, you indicate that you understand the above conditions of participation in this study, that you have had the opportunity to have your questions answered by the researcher, and that you consent to participate in this research.                     
                </div>
                -->
            </div>

            <div style="display:flex;flex-direction:row;justify-content:center;align-items:center;">
                <div style="font-size:11px;margin-right:10px;">By entering your name and student ID in these boxes, you indicate that you understand the above conditions of participation in this study, that you have had the opportunity to have your questions answered by the researcher, and that you consent to participate in this research.</div>
                <input type="text" id="nameInput" style = "width: 200px; margin-right:10px;" placeholder="First + Last Name">
                <input type="text" id="IDInput" style = "width: 100px" placeholder="Student ID #">
            </div>
        </div>
        <button id="consentButton" class="h_begin_button" onclick="changePage()" disabled>Continue</button>
    </div>

    <script>
        ///////////////////////////////////////////////////////////////////////////////////////////
        // CHECKING FOR USER INPUT ON THE CONSENT FORM PAGE
        //
        //
        //// In this area, the eventlistener will watch for changes in the website (on this page, just the checkbox) and will update it based on whether the box has been checked or not 
        const nameField = document.getElementById('nameInput');     //The textbox for the user's full name
        const IDField = document.getElementById('IDInput');         //The textbox for the user's student id number
        const button = document.getElementById('consentButton');    //The button that will be used to officially "sign" the consent form

        window.user_id = "";        //Establish a global variable to be used later: the user's student id
        window.user_name = "";      //Establish a global variable to be used later: the user's full name 

        function checkInput()
        {
            console.log("Check");
            if (nameField.value.trim() !== '' && IDField.value.trim() !== '') {
                button.disabled = false;
            } else {
                button.disabled = true;
            }
        }

        // Attach the input event listener to the input field
        nameField.addEventListener('input', function() {
            checkInput();
            window.user_name = nameField.value;
        });
        IDField.addEventListener('input', function() {
            checkInput();
            window.user_id = IDField.value;
        });
        ////
        ////
        ///////////////////////////////////////////////////////////////////////////////////////////
    </script>

    <div id="backgroundPage" style="display:none;flex-direction:column;width:1800px;height:900px;align-items:center;">
        <div style="font-size:40px;">Tutorial</div>
        <div style="background-color:rgb(240, 240, 240);margin-bottom:20px;width:1800px;">
            <div id="tutorial_title" class="h_background_bullet_title">DisjointWith</div>
            <div id="tutorial_text" class="h_background_bullet_text">The classes do not and cannot share any subclasses or values. For example:<br>Class A is disjointWith Class B. Class A = [1, 2, 3], Class B = [4, 5, 6]</div>
        </div>
        <div id="tree-container-tutorial" style="display:flex;background-color:rgb(240, 240, 240);width:auto;height:auto;max-height:700px;margin-bottom:20px;justify-content:center;"></div>
        <video id = "tutorial_video" controls height = "700" style = "margin-bottom:20px;display:none" src="./assets/mp4/wine-intersectionOf.mp4"></video>
        <button id="tutorial_button" class="h_begin_button" onclick="iterateTutorial()">Next</button>
    </div>

    <script>
        ///////////////////////////////////////////////////////////////////////////////////////////
        // ITERATE THROUGH THE DIFFERENT PAGES OF THE TUTORIAL
        //
        //
        //// In this area, the tutorial pages for each ontology relationship are displayed. Once all have been shown, it will move onto the actual test
        let tutorial_value = 0;     //Value to keep track of which page of the tutorial is currently displayed 

        //The four interactive videos that will be used in the tutorial
        let video_sources = [
            "./assets/mp4/pasta-disjointWith.mp4",
            "./assets/mp4/fruit-unionOf.mp4",
            "./assets/mp4/citizen-complementOf.mp4",
            "./assets/mp4/wine-intersectionOf.mp4",
        ]

        const tutorialTitle = document.getElementById("tutorial_title");                //The main title text of the tutorial page
        const tutorialText = document.getElementById("tutorial_text");                  //The inner text of the tutorial page
        const tutorialButton = document.getElementById("tutorial_button");              //The button on the tutorial page to proceed forward
        const tutorialVisual = document.getElementById("tree-container-tutorial");      //The tree container of the tutorial page, used to hold visualizations
        const tutorialVideo = document.getElementById("tutorial_video");                //The video container of the tutorial page, used to hold interactive videos 

        //All titles to be used in the tutorial
        let titles = ["What is an Ontology?", 
            "DisjointWith", 
            "UnionOf",
            "ComplementOf",
            "IntersectionOf"]

        //All inner text blocks that will be used in the tutorial 
        let tutorials = ["An ontology is like a detailed map of knowledge about a specific topic or domain. It organizes information by defining concepts, their properties, and how they relate to each other, much like a family tree or a blueprint."
            + "Think of it as a way to make sure everyone understands the same ideas and relationships in the same way when discussing or working with complex information."
            + "\n\nClasses = represent concepts or sets of instsances in the domain"
            + "\n\nInstances = specific objects b elonging to respective Classes"
            + "\n\nRelations = used to associate Classes, Instances, or any other entity within the ontology"
            + "\n\nFor example, a 'Wine' class represents all wines that exist. The 'Wine' class can be defined with subclasses such as 'Red Wine', 'White Wine', and 'Rose Wine'. In other words, these subclasses have one shared superclass."
            + "\n\nThe figure shows the relations between classes and instances in the wine domain. 'PinotNoir' class has one instance: 'MoutadamPinotNoir'. The 'Winery' class has two instances: 'Mountadam' and 'Elyse'. The 'FineFlavor' class has three instances: 'Delicate', 'Moderate' and 'Strong'. 'MountadamPinotNoir' is associated with two other instances ussing relations MadeFrom and 'HasFlavor'.",

            "DisjointWith guarantees that an instance of one class cannot simultaneously be an instance of another specified class. "
            + "\n\nFor example, given two classes: 'Pasta' and 'Fruit', that are stated to be disjoint with each other, we can deduce that if A is an instance of 'Pasta', then A is not an instance of 'Fruit'."
            + "\n\nThis example will be demonstrated in the video below using a network visualization:",

            "unionOf states a combination of two or more classes, where the resulting class contains all instances present in either of the original class. "
            + "\n\nFor example, given two classes: 'SweetFruit' and 'NonSweetFruit', we can state that a third class: 'Fruit' is the union of 'SweetFruit' and 'NonSweetFruit'."
            + "\n\nThis example will be demonstrated in the video below using a circle packing visualization:",

            "complementOf selects all instances from the domain of discourse that do not belong to a certain class. "
            + "\n\nFor example, given two classes: 'Children' and 'SeniorCitizens', to express 'Children' are not 'SeniorCitizens', we would essentially state that Children is a subclass of the complement of 'SeniorCitizens'."
            + "\n\nThis example will be demonstrated in the video below using a tree map visualization:",

            "intersectionOf a class A and class B is the set of instances that are in both. "
            + "\n\nFor example, a class 'WhiteWine' can be defined as the intersection of the class 'Wine' and the set of things that are white in color. In other words, if something is white and a wine, then it is an instance of 'WhiteWine'."
            + "\n\nThis example will be demonstrated in the video below using a circle packing visualization:",
            ]

        //Set the title and inner text of the tutorial page to the first predetermined values 
        tutorialTitle.innerText = titles[0];       
        tutorialText.innerText = tutorials[0];     

        //Iterate through the tutorial, only displaying the appropriate information and media
        function iterateTutorial()
        {
            //Iterate the tutorial page value, and change the titles and inner text accordingly 
            tutorial_value = tutorial_value + 1;
            tutorialTitle.innerText = titles[tutorial_value];
            tutorialText.innerText = tutorials[tutorial_value];

            //If the second page of the tutorial has been reached 
            if (tutorial_value == 1)
            {
                //After the first tutorial page, change the media from the still image to an interactive video
                tutorialVisual.style.display = "none";
                tutorialVideo.style.display = "inline-block";
                tutorialVideo.src = video_sources[0];
                tutorialVideo.load();
            }
            //If the video tutorial is already being displayed...
            else if (tutorial_value < 5)
            {
                //Change the tutorial video to the following video, and reload it 
                tutorialVideo.src = video_sources[tutorial_value - 1];
                tutorialVideo.load();

                //Once the final page of the tutorial is reached, change the button text to signal a stopping point 
                if (tutorial_value == 4) tutorialButton.innerText = "STOP HERE";
            }
            //Once the final page of the tutorial is completed...
            else if (tutorial_value == 5)
            {
                //Set up the first assessment question, and save information obtained earlier in the consent form 
                question_var = visualOrder[0];
                document.getElementById("tree-container").replaceChild(visuals[visualOrder[0]], document.getElementById("tree-container").firstChild);
                let user_name = nameField.value;
                let user_id =  IDField.value;

                //Change the page, signaling the tutorial is completed 
                changePage(-1, user_name, user_id);
            }
        }

        const vt1 = document.createElement("img");   //The first visual of the tutorial, which is a still image 

        //Establish source file and size of second temporary visualization
        vt1.src = "../ontologyExample.png"; 
        vt1.style.width = "100%"
        vt1.style.height = "100%"

        const vt2 = packing3(tutorialPastaCircle);          //The first interactive visual in the tutorial 
        const vt3 = fruitsPacking(tutorialFruitCircle);     //The second interactive visual in the tutorial 
        const vt5 = nodeLink3(tutorialWineBaseline);        //The third interactive visual in the tutorial 
        const vt4 = treeMap3(tutorialCitizenTree);          //The fourth interactive visual in the tutorial 

        const visuals_tutorial = [vt1, vt2, vt3, vt4, vt5]    //Variable to store both temporary visualizations

        document.getElementById("tree-container-tutorial").appendChild(visuals_tutorial[0])
        ////
        ////
        ///////////////////////////////////////////////////////////////////////////////////////////
    </script>

    <div id="questionPage" style="display:none;flex-direction:column;width:1800px;height:900px;align-items:center;">
        <div style="background-color:rgb(240, 240, 240);margin-bottom:20px;width:1800px;min-height:150px;">
            <div id="questionTitle" class="h_background_bullet_title">DisjointWith</div>
            <div id="questionText" class="h_background_bullet_text" style="font-size:30px;">The classes do not and cannot share any subclasses or values. For example:<br>Class A is disjointWith Class B. Class A = [1, 2, 3], Class B = [4, 5, 6]</div>
        </div>
        <div style="display:flex;flex-direction:row;margin-bottom:20px;justify-content:space-evenly;width:1800px">
            <button id="pageButton1" class="ans_button" onclick="changePage(0)">Answer A</button>
            <button id="pageButton2" class="ans_button" onclick="changePage(1)">Answer B</button>
            <button id="pageButton3" class="ans_button" onclick="changePage(2)">Answer C</button>
            <button id="pageButton4" class="ans_button" onclick="changePage(3)">Answer D</button>
        </div>
        <div id="tree-container" style="display:none;background-color:rgb(240, 240, 240);width:auto;height:auto;max-height:700px;margin-bottom:20px;justify-content:center;"></div>
        <iframe id="baselineContainer" src="./The Pizza Ontology.html" style="min-height:700px; width:1800px" scrolling="no"></iframe>
        <canvas id="aoiCanvas" width="1920" height="1080" style="position: absolute; top: 0; left: 0; z-index: 10; pointer-events: none;"></canvas>
    </div>

    <script>
        //List of all questions
        const pageQuestions = 
        //Baseline/Network Visual Questions
        [{
            1: "How is the class 'CheesyPizza' defined?",
            2: "Is the following statement true or false: the intersectionOf 'Pizza' and 'MeatTopping' is 'MeatyPizza'",
            3: "Is the following statement true or false: 'NonVegetarianPizza' is a subclass of the complementOf 'VegetarianPizza'",
            4: "'VegetarianPizza' must have neither 'SeafoodTopping' nor 'MeatTopping', what does this mean?",
            5: "The class 'Spiciness' describes 3 levels of spiciness including 'Hot', 'Medium' and 'Mild'. These levels are defined using which relationship",
            6: "The toppings of a 'NamedPizza' called 'Margherita' is defined as the unionOf two toppings, which are? ",
            7: "Is the following statement true or false: 'HerbSpiceTopping' has two subclasses 'CajunSpiceTopping' and 'RosemaryTopping', which are disjointWith each other.",
            8: "'DeepPanBase' is a 'PizzaBase' that is disjointWith which class?",
        },
        //Circle Packing Questions
        {
            1: "Which of the following best describes the class 'VegetarianPizza1?'",
            2: "Is the following statement true or false: the intersectionOf 'Pizza' and 'ThinAndCrispyBase' is 'ThinAndCrispyPizza'?",
            3: "The subclasses of 'VegetarianPizza' must be complementOf?",
            4: "Is the following statement true or false: since a 'VegetarianPizza' can have neither 'SeafoodTopping' nor 'MeatTopping', these two classes - 'SeafoodTopping' and 'MeatTopping' - must be complementOf each other. ",
            5: "The toppings of a 'NamedPizza' called 'FruttiDiMare' is defined as the unionOf three toppings, which are?  ",
            6: "'Napoletana' is a 'NamePizza' defined as the unionOf how many toppings?",
            7: "'ChickenTopping' is a 'MeatTopping' that is disjointWith which class?",
            8: "Can a topping belonging to the class 'PizzaBase' also belong to another class 'PizzaTopping'?",
        },
        //Tree Map Questions
        {
            1: "Which of the following best describes the class 'SpicyPizza?'",
            2: "How is the class 'SpicyTopping' defined?",
            3: "Fill in the blank: since any 'Pizza' that is not a 'VegetarianPizza' is a 'NonVegetarianPizza', then the subclass of 'VegetarianPizza' must be ____ 'NonVegetarianPizza'. ",
            4: "In the context of defining allowable toppings for 'VegetarianPizza', which class is 'SeafoodTopping' complementOf?",
            5: "'Soho' is a 'NamePizza' defined as the unionOf how many toppings? ",
            6: "'American' is a 'NamedPizza' with 3 toppings including 'MozzarellaTopping', 'PeperoniSausageTopping', and 'TomatoTopping'. These toppings are defined using which relationship? ",
            7: "Can a topping belonging to the class 'SlicedTomatoTopping' also belong to another class  'SundriedTomatoTopping'?",
            8: "Is the following statement true or false: all subclasses of 'NamePizza' (e.g., 'American', 'Cajun', 'FourSeasons', etc.) are disjointWith each other. ",
        }];

        //List of all answers
        const pageAnswers = 
        [{
            1: ["The union of 'Pizza' and 'CheeseTopping'",
                "The intersection of 'Pizza' and 'PizzaTopping'",
                "The union of 'Pizza' and 'PizzaTopping'",
                "The intersection of 'Pizza' and 'CheeseTopping'"],
            2: ["True","False"],
            3: ["True","False"],
            4: ["'SeafoodTopping' is disjointWith 'MeatTopping'",
                "'SeafoodTopping' is complementOf 'MeatTopping'",
                "'SeafoodTopping' is unionOf 'MeatTopping'",
                "'SeafoodTopping' is intersectionOf 'MeatTopping'"],
            5: ["disjointWith",
                "complementOf",
                "unionOf",
                "intersectionOf"],
            6: ["'MushroomTopping' & 'TomatoTopping'",
                "'MozzarellaTopping' & 'TomatoTopping'",
                "'CheeseTopping' & 'TomatoTopping'",
                "'MozzarellaTopping' & 'CheeseTopping'"],
            7: ["True", "False"],
            8: ["'StuffedCrustBase'",
                "'CheeseCrustBase'",
                "'ThinAndCrispyBase'",
                "'ThinPanBase'"],
        },
        {
            1: ["Any Pizza that intersects 'CheeseTopping'",
                "Any Pizza that intersects 'NutTopping'",
                "Any Pizza that intersects 'SauceTopping'",
                "Any Pizza that intersects 'VegetarianTopping'"],
            2: ["True","False"],
            3: ["'MeatyPizza'",
                "'NonVegetarianPizza'",
                "'SeafoodPizza'",
                "'CheesyPizza'"],
            4: ["True","False"],
            5: ["'FruitTopping', 'CheeseTopping', 'TomatoTopping'",
                "'OliveTopping', 'PepperTopping', 'TomatoTopping'",
                "'GarlicTopping', 'MixedSeafoodTopping', 'TomatoTopping'",
                "'SpinachTopping', 'NutTopping', 'TomatoTopping'"],
            6: ["4","5","6","7"],
            7: ["'HamTopping'",
                "'MeatTopping'",
                "'PizzaTopping'",
                "'Food'"],
            8: ["Yes, because 'PizzaBase' and 'PizzaTopping' are unionOf 'Pizza'",
                "No, because 'PizzaBase' and 'PizzaTopping' are intersectionOf 'Pizza'",
                "Yes, because 'PizzaBase' and 'PizzaTopping' are complementOf 'Pizza'",
                "No, because 'PizzaBase' and 'PizzaTopping' are disjointWith one another"],
        },
        {
            1: ["Any 'Pizza' that intersections 'SpicyTopping'",
                "Any 'PizzaTopping' that intersects 'Spiciness'",
                "Any 'PizzaTopping' that intersects 'SpicyTopping'",
                "Any 'SpicyTopping' that intersects 'Spiciness'"],
            2: ["The unionOf 'Medium' and 'Mild'",
                "The intersectionOf 'Spiciness' and 'Medium'",
                "The intersectionOf 'PizzaTopping' and 'Hot'",
                "The unionOf 'Spiciness' and 'Mild'"],
            3: ["DisjointWith",
                "ComplementOf",
                "UnionOf",
                "IntersectionOf"],
            4: ["DisjointWith",
                "MeatTopping",
                "UnionOf",
                "IntersectionOf"],
            5: ["4","5","6","7"],
            6: ["DisjointWith",
                "ComplementOf",
                "IntersectionOf",
                "UnionOf"],
            7: ["Yes, because 'SlicedTomatoTopping' and 'SundriedTomatoTopping' are unionOf 'TomatoTopping'",
                "No, because 'SlicedTomatoTopping' and 'SundriedTomatoTopping' are intersectionOf one another",
                "Yes, because 'SlicedTomatoTopping' and 'SundriedTomatoTopping' are complementOf one another",
                "No, because 'SlicedTomatoTopping' and 'SundriedTomatoTopping' are disjointWith one another"],
            8: ["True","False"],
        }
        ];

        //List of all correct answers (by index)
        const pageSolutions =   [
            [3, 0, 0, 1, 2, 1, 0, 2], 
            [0, 3, 1, 0, 2, 1, 0, 3], 
            [0, 2, 1, 1, 2, 3, 3, 0]];
    </script>

    <!-- The parent container for calibration -->
    <div id="h_calibration" class="h_calibration" style="display:none">
        <div id="calibration-container" class="calibration_parent">
        <!-- Initializing the hidden canvas webgazer needs for calibration. This canvas is not visible -->
        <canvas id="plotting_canvas" style="display: none;"></canvas>
        <!-- The 9 clickable dots will be appended here by generateCalibrationDots() -->
        <div id="calibration-dots">
            <!-- dots get created dynamically in calibration.js -->
        </div>
    
        <!-- The popup that appears once you complete calibration -->
        <div id="calibration-score-popup" style="display:none;">
            <p id="calibration-score-text">
            Your calibration score: <span id="calibration-score-percentage"></span>%
            </p>
            <button id="retry-button">Retry</button>
            <button id="proceed-button" onclick="disableCalibration()">Proceed</button>
        </div>
        </div>
    </div>

    <!--Display for the final thank you and results page-->
    <div id="outroPage" class="h_sub" style="Display:none">
        <div id="outroText" class="h_outro">
            Final
        </div>
    </div>

    <div id="intermissionPage" class="h_sub" style="Display:none">
        <div id="intermission" class="h_outro">
            Visual 1 complete
        </div>
        <button id="pageButton" class="ans_button" onclick="changePage()">Continue</button>
    </div>

    <script>
        ///////////////////////////////////////////////////////////////////////////////////////////
        // UPDATING VISUALS, QUESTIONS AND VISUALIZATIONS BASED ON PAGE NUMBER
        //
        //
        //// In this area, the researchers will be able to update the order and combination of questions, answers and visualiations 
        /// There will be three sets of questions along with 3 sets of corresponding answers, and two different types of visualizations

        let page_value = -1;        //Page number variable, used to track the current page state
        let question_value = -1;    //Question number variable, reset between visualization/question sets
        var question_var = 1;       //The index for which questions/answer options will be used: either 0, 1, or 2
        var visualization_var = 0;  //The binary index for which type of visualization will be used: either 0 or 1
        let answers = [];           //Variable to keep track of user answers

        let page_time = [];         //Variable to keep track of the time spent on each page by the user
        let page_index = 0


        let calibrated = false;

        let startTime = new Date().getTime();   //Variable to keep track of the time spent on the current page. This begins as soon as the page is loaded, meaning the first value can most-likely be disgarded 

        const menuIntro = document.getElementById("introPage");                 //Variable tied to the intro HTML page
        const menuBackground = document.getElementById("backgroundPage")        //Variable tied to the background information HTML page
        const menuQuestion = document.getElementById("questionPage")            //Variable tied to the main question HTML page
        const menuIntermission = document.getElementById("intermissionPage");   //Variable tied to the intermission page between visualizations
        const menuOutro = document.getElementById("outroPage");                 //Variable tied to the final outro HTML page
        const continueButton = document.getElementById("pageButton");           //Variable tied to the page button HTML component
        const menuCalibration = document.getElementById("h_calibration");       //Variable tied to the eye-tracking calibration HTML page

        const questionButtons = [
            document.getElementById("pageButton1"),
            document.getElementById("pageButton2"),
            document.getElementById("pageButton3"),
            document.getElementById("pageButton4")
        ]

        const v1 = nodeLink3(PizzaBaselineData);
        //const v2 = treeMap(PizzaTreeMapData);
        //const v2 = packing3(pizzaCirclePackData)
        const v2 = circlePack(circlePackData);
        //const v3 = treeMap3(PizzaTreeMapData)
        const v3 = treeMap();

        const visuals = [v1, v2, v3]    //Variable to store both temporary visualizations

        document.getElementById("tree-container").appendChild(visuals[visualization_var])

        function disableCalibration() {
            console.log('Calibration completed. Proceeding to question and answer page.');
        
            // Hide the calibration UI
            document.getElementById("h_calibration").style.display = "none";
            // Hide the calibration score popup
            document.getElementById("calibration-score-popup").style.display = "none";
            // Show the question and answer page
            document.getElementById("questionPage").style.display = "flex";

            startTime = new Date().getTime();
            page_time.push(startTime);
            
            // Initialize the first question
            document.getElementById("questionText").innerText = pageQuestions[question_var][question_value];
            document.getElementById("questionTitle").innerText = ("Question " + question_value);
            for(let i = 0; i < 4; i++) {
                questionButtons[i].innerText = pageAnswers[question_var][question_value][i];
            }
            startMainTracking();
            calibrated = true;
        }
        
        
    
        // Make sure the function is accessible globally
        window.disableCalibration = disableCalibration;

        function showWebcamElements() {
            // The IDs that WebGazer auto-creates:
            //   #webgazerVideoFeed, #webgazerVideoContainer, #webgazerFaceOverlay, #webgazerFaceFeedbackBox, #webgazerGazeDot
            const videoFeed = document.getElementById("webgazerVideoFeed");
            const faceOverlay = document.getElementById("webgazerFaceOverlay");
            const faceFeedbackBox = document.getElementById("webgazerFaceFeedbackBox");
        
            if (videoFeed) {
                videoFeed.style.removeProperty("display"); 
                // or videoFeed.style.display = "block";
            }
            if (faceOverlay) {
                faceOverlay.style.removeProperty("display"); 
            }
            if (faceFeedbackBox) {
                faceFeedbackBox.style.removeProperty("display"); 
            }
            
            // If you want to show the dot here too, you can:
            const gazeDot = document.getElementById("webgazerGazeDot");
            if (gazeDot) {
                gazeDot.style.removeProperty("display");
            }
        }

        function hideWebcamElements() {
            const videoFeed = document.getElementById("webgazerVideoFeed");
            const faceOverlay = document.getElementById("webgazerFaceOverlay");
            const faceFeedbackBox = document.getElementById("webgazerFaceFeedbackBox");
            const gazeDot = document.getElementById("webgazerGazeDot");
        
            if (videoFeed) videoFeed.style.display = "none";
            if (faceOverlay) faceOverlay.style.display = "none";
            if (faceFeedbackBox) faceFeedbackBox.style.display = "none";
            if (gazeDot) gazeDot.style.display = "block";
        }
        
        

        // Function to handle calibration sequence
        function startCalibration() {
            console.log('Starting calibration mode...');
            document.getElementById('h_calibration').style.display = 'flex'; // Show calibration UI
            document.getElementById('backgroundPage').style.display = 'none'; // Hide other pages

            showPredictionDots(); // Enable prediction points for calibration
            showWebcamElements(); 

        }

        // Function to exit calibration sequence
        function exitCalibration() {
            console.log('Exiting calibration mode...');
            document.getElementById('h_calibration').style.display = 'none'; // Hide calibration UI
            document.getElementById('backgroundPage').style.display = 'flex'; // Show main content

            hidePredictionDots(); // Disable prediction points after calibration
            hideWebcamElements(); // you define a similar function that sets display="none"

        }

        //Function to change the main assessment page
        function changePage(ans = -1) {
            //If an answer is provided as a parameter, push it to the answers list
            if (ans !== -1) answers.push(ans);
            //Increment the page value
            page_value += 1;
            
            //If the assessment page has just been opened
            if (page_value == 0)
            {
                //Check to see if the network visualization needs to be implemented or removed
                if(visualSet != 0 && visualSet != 1)
                {
                    document.getElementById("baselineContainer").style.display = "none";
                    document.getElementById("tree-container").style.display = "flex";
                }
            }
            //If question 9 is reached, and it will now move to the second visualiation
            else if (page_value == 9)
            {
                //Check to see if the network visualization needs to be implemented or removed
                if(visualSet == 0 || visualSet == 1)
                {
                    document.getElementById("baselineContainer").style.display = "none";
                    document.getElementById("tree-container").style.display = "flex";
                }
                else if(visualSet == 2 || visualSet == 4)
                {
                    document.getElementById("baselineContainer").style.display = "inline";
                    document.getElementById("tree-container").style.display = "none";
                }

                //Reset the question value
                question_value = 0;
                //Set the new question set to that of the new visualiation
                question_var = visualOrder[1];
                //Replace the current visualization with the following 
                document.getElementById("tree-container").replaceChild(visuals[visualOrder[1]], document.getElementById("tree-container").firstChild);
            }
            //If question 17 is reached, and it will now move to the third visualization
            else if (page_value == 17)
            {
                //Check to see if the network visualization needs to be implemented or removed
                if(visualSet == 2 || visualSet == 4)
                {
                    document.getElementById("baselineContainer").style.display = "none";
                    document.getElementById("tree-container").style.display = "flex";
                }
                else if(visualSet == 3 || visualSet == 5)
                {
                    document.getElementById("baselineContainer").style.display = "inline";
                    document.getElementById("tree-container").style.display = "none";
                }

                //Reset the question value
                question_value = 0;
                //Set the new question set to that of the new visualiation
                question_var = visualOrder[2];
                //Replace the current visualization with the following 
                document.getElementById("tree-container").replaceChild(visuals[visualOrder[2]], document.getElementById("tree-container").firstChild);
            }

            //Increment the question value
            question_value += 1;  

            //Run function to update the frontend webpage visuals 
            updateFrontEnd();
        }
        

        //Function for updating visuals based on the new value of page_value
        //Iterates through different if-statements to check whether the condition for displaying certain pages is met 
        function updateFrontEnd() 
        {
            //If the page value is equal to 0, begin the tutorial sequence
            if (page_value == 0)
            {
                menuIntro.style.display = "none";
                menuBackground.style.display = "flex";
            }
            else if (page_value === 1) {
                //If calibration has not yet been completed, then begin the calibration sequence
                if (!calibrated)
                {
                    menuIntro.style.display = "none";
                    menuBackground.style.display = "none";
                    menuQuestion.style.display = "none";
                    
                    // Show the calibration overlay
                    document.getElementById("h_calibration").style.display = "block";
                    
                    // Actually run the calibration code
                    window.startCalibration();
                    
                    console.log("calibration started");
                }
                //If the calibration has been completed, then disable calibration and move on to the assessment 
                else
                {
                    console.log("STOPPING CALIBRATION");
                    disableCalibration();
                }
            } 
            //If the page value is between 0 and 24 then perform the regular assessment frontend update
            else if (page_value > 0 && page_value <= 24) {
                //Ensure the assessment page is displayed, regardless of whether or not it already is 
                menuBackground.style.display = "none";
                menuIntermission.style.display = "none";
                menuQuestion.style.display = "flex";
        
                //Replace the page questions and titles with the appropriate question values
                document.getElementById("questionText").innerText = pageQuestions[question_var][question_value];
                document.getElementById("questionTitle").innerText = ("Question " + page_value);

                //Iterate through the answer buttons to replace them with the appropriate possible answers 
                for(let i = 0; i < 4; i++)
                {
                    //Disable 2 of the question buttons if the possible answers are only true and false
                    if (pageAnswers[question_var][question_value].length == 2)
                    {
                        questionButtons[2].style.display = "none";
                        questionButtons[3].style.display = "none";
                    }
                    else
                    {
                        questionButtons[2].style.display = "inline-block";
                        questionButtons[3].style.display = "inline-block";
                    }
                    questionButtons[i].innerText = pageAnswers[question_var][question_value][i];
                }

                //Once the assessment begins, push the current Unix timestamp to the page time list
                if (page_value == 1)
                {
                    startTime = new Date().getTime();
                    page_time.push(startTime);
                }
                //If the assessment has already begun, push the amount of time spent on the question by the user 
                else
                {
                    const endTime = new Date().getTime();
                    const timeSpent = (endTime - startTime) / 1000.0;
                    startTime = endTime;
                    page_time.push(timeSpent);
                }
            } 
            //If the page value is above 21, then end the study, concluding that all questions have been answered 
            else if (page_value > 24) {
                // Stop the gaze data tracking immediately.
                stopMainTracking();
                
                // Hide the question page and show the outro.
                menuQuestion.style.display = "none";
                menuOutro.style.display = "flex";
                continueButton.style.display = "none";
                document.getElementById("outroText").textContent = "Thank you for participating! Please raise your hand and let the researcher know you are done";

                //Calculate the amount of time spent by the user on the final page 
                const endTime = new Date().getTime();
                const timeSpent = (endTime - startTime) / 1000.0;
                page_time.push(timeSpent);

                //USER ANSWERS, CORRECT ANSWERS, AND PAGE TIME
                console.log("PAGE TIME: " + page_time);
                console.log("ANSWERS: " + answers);
                console.log("SOLUTIONS: " + pageSolutions[0].concat(pageSolutions[1], pageSolutions[2]));

                //Calculate the user score 
                let results = checkScore();
                let date = new Date(page_time[0]);

                //Append all necessary information that will be exported in the user info txt file to a blob
                text_content = `User Name: ${window.user_name}\nUser ID: ${window.user_id}\nQuestion Set: ${(visualSet + 1)}\nUser Score: ${results}\nUser Time: ${page_time.toString()}\nTotal Time: ${page_time.slice(1).reduce((sum, num) => sum + num, 0)}\n\nTranslated Unix: ${date.toString()}`;
                let blob = new Blob([text_content], { type: "text/plain" });

                //Push the blob information to a txt file to be exported
                let a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = "user_info.txt"; 

                // Append, click, and remove the element
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                // Automatically download the gaze data CSV.
                downloadGazeDataCSV();
            }
        }

        //Calculate the score of the user for each question (0 for wrong, 1 for right) and the final score value out of 1.0
        function checkScore()
        {
            results = [];
            //Concat the solutions of each question set into a single list
            final_answers = pageSolutions[0].concat(pageSolutions[1], pageSolutions[2]);
            temp = 0.0;

            //For each question, compare the user response with the predetermined correct answer, and push a 0 or 1 value accordingly 
            for (i = 0; i < 24; i++)
            {   
                results.push(final_answers[i] == answers[i] ? 1:0);
                if (final_answers[i] == answers[i])
                {
                    temp++;
                }
            }
            results.push((temp/24.0));
            return results;
        }
        ////
        ////
        ///////////////////////////////////////////////////////////////////////////////////////////
    </script>

    <script>
        ///////////////////////////////////////////////////////////////////////////////////////////
        // TRACKING AND ACTING-UPON USER KEYBAORD INPUTS
        //
        //
        //// In this area, keyboard-inputs are tracked and the necessary functions are acted upon, all preventing default browser actions
        //// The majority of these keyboard shortcuts will be ctrl + a corresponding letter key 

        //Event listener checking for keybard input 
        document.addEventListener('keydown', function (event) {
            //If the ctrl key is pressed, now perform a hotkey action based on the subsequent key pressed
            if (event.ctrlKey)
            {
                event.preventDefault();
                switch(event.key)
                {
                    //Keyboard shortcut for enabling AOI selection
                    case 'z':
                        enableAOISelection();
                        break;
                    //Keyboard shortcut for downloading the selected AOI selections
                    case 'x':
                        //Prevent default browser activity, and instead run the function to save AOI selections as a JSON file 
                        saveAOIs();
                        break;  
                    //Skip the calibration sequence (useful for bug testing)
                    case 'p':
                        disableCalibration();
                        break;
                }   
            }
        });
        ////
        ////
        ///////////////////////////////////////////////////////////////////////////////////////////
    </script>
</body>

